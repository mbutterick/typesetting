<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>Quad: document processor</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="tocviewselflink" data-pltdoc="x">Quad:<span class="mywbr"> &nbsp;</span> document processor</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Installing_.Quad%29" class="tocviewlink" data-pltdoc="x">Installing Quad</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Why_care_about_document_processors_%29" class="tocviewlink" data-pltdoc="x">Why care about document processors?</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.What_does_.Quad_do_%29" class="tocviewlink" data-pltdoc="x">What does Quad do?</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.What_doesn_t_.Quad_do_%29" class="tocviewlink" data-pltdoc="x">What doesn&rsquo;t Quad do?</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Theory_of_operation%29" class="tocviewlink" data-pltdoc="x">Theory of operation</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Enough_talk___let_s_rock%29" class="tocviewlink" data-pltdoc="x">Enough talk &#8212;&#160;let&rsquo;s rock</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Bottlenecks__roadblocks____unanswered_questions%29" class="tocviewlink" data-pltdoc="x">Bottlenecks, roadblocks, &amp; unanswered questions</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Why_is_it_called_.Quad_%29" class="tocviewlink" data-pltdoc="x">Why is it called Quad?</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Quad__document_processor%29" class="tocsubseclink" data-pltdoc="x">Quad:<span class="mywbr"> &nbsp;</span> document processor</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Installing_.Quad%29" class="tocsubseclink" data-pltdoc="x">Installing Quad</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Why_care_about_document_processors_%29" class="tocsubseclink" data-pltdoc="x">Why care about document processors?</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Why_not_keep_using_.La.Te.X_%29" class="tocsubseclink" data-pltdoc="x">Why not keep using La<span class="mywbr"> &nbsp;</span>Te<span class="mywbr"> &nbsp;</span>X?</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Why_not_use_more_.H.T.M.L_.C.S.S_%29" class="tocsubseclink" data-pltdoc="x">Why not use more HTML/<span class="mywbr"> &nbsp;</span>CSS?</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.What_does_.Quad_do_%29" class="tocsubseclink" data-pltdoc="x">What does Quad do?</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.What_doesn_t_.Quad_do_%29" class="tocsubseclink" data-pltdoc="x">What doesn&rsquo;t Quad do?</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Theory_of_operation%29" class="tocsubseclink" data-pltdoc="x">Theory of operation</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.Enough_talk___let_s_rock%29" class="tocsubseclink" data-pltdoc="x">Enough talk &#8212;&#160;let&rsquo;s rock</a></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#%28part._.Bottlenecks__roadblocks____unanswered_questions%29" class="tocsubseclink" data-pltdoc="x">Bottlenecks, roadblocks, &amp; unanswered questions</a></td></tr><tr><td><span class="tocsublinknumber">8<tt>&nbsp;</tt></span><a href="#%28part._.Why_is_it_called_.Quad_%29" class="tocsubseclink" data-pltdoc="x">Why is it called Quad?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">6.4.0.7</span></div><h2><a name="(part._.Quad__document_processor)"></a><a name="(mod-path._quad)"></a>Quad: document processor</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Matthew Butterick &lt;<a href="mailto:mb@mbtype.com">mb@mbtype.com</a>&gt;</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">quad</span></span></td></tr></table></p><p><span style="font-style: italic">This documentation explains software that is under development. It is therefore rife with optimistic claims and wishful thinking.</span></p><h3>1<tt>&nbsp;</tt><a name="(part._.Installing_.Quad)"></a>Installing Quad</h3><p><div class="SIntrapara">At the command line:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">raco pkg install quad</span></p></td></tr></table></div></p><p><div class="SIntrapara">After that, you can update the package like so:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">raco pkg update quad</span></p></td></tr></table></div></p><p>Quad is not usable software. It is currently in &ldquo;documented demo&rdquo; mode. There is no need to submit issues or bug reports. Fiddle with it at your own risk.</p><h3>2<tt>&nbsp;</tt><a name="(part._.Why_care_about_document_processors_)"></a>Why care about document processors?</h3><p>A document processor is a rule-driven typesetter. It takes a text-based source file as input and converts it into a page layout.</p><p>For instance, LaTeX is a document processor. So are web browsers. Quad borrows from both traditions &#8212;&#160;it&rsquo;s an attempt to modernize the good ideas in LaTeX, and generalize the good ideas in web browsers.</p><p>Document processors sit opposite WYSIWYG tools like Word and InDesign. There, the user controls the layout by manipulating a representation of the page on the screen. This is fine as far as it goes. But changes to the layout &#8212;&#160;for instance, a new page size &#8212;&#160;often require a new round of manual adjustments.</p><p>A document processor, by contrast, relies on markup codes within the text to determine the layout programmatically. Compared to WYSIWYG, this approach offers less granular control. But it also creates a more flexible relationship between the source and its possible layouts.</p><p>Another benefit of document processors is that it permits every document to have a high-level, text-based source file that&rsquo;s independent of any particular output format (rather than the opaque binary formats endemic to Word, InDesign, et al.)</p><h4>2.1<tt>&nbsp;</tt><a name="(part._.Why_not_keep_using_.La.Te.X_)"></a>Why not keep using LaTeX?</h4><p>I wouldn&rsquo;t want to criticize software merely for being old. It&rsquo;s a great compliment to LaTeX that it&rsquo;s endured this long. But 1) it&rsquo;s never made much headway beyond its original audience of scientific &amp; technical writers; 2) the last 25 years of advances in digital typesetting have been implemented as a huge (occasionally tenuous) tower of patches; 3) the core codebase is increasingly opaque to today&rsquo;s programmers. Meaning, if LaTeX were plausibly rewritable, it would&rsquo;ve been rewritten by now.</p><p>Instead, let&rsquo;s take its good ideas &#8212;&#160;there are many &#8212; and terraform a new planet.</p><h4>2.2<tt>&nbsp;</tt><a name="(part._.Why_not_use_more_.H.T.M.L_.C.S.S_)"></a>Why not use more HTML/CSS?</h4><p>In principle, it&rsquo;s possible to generate PDF documents from a web browser. Support for paper-based layouts has been part of the CSS concept <a href="https://www.w3.org/People/howcome/p/cascade.html">since the beginning</a> (though it&rsquo;s been lightly used).</p><p>But web browsers have a few limitations. First, web browsers only render HTML, and many typesetting concepts (e.g., footnotes) don&rsquo;t correspond to any HTML entity. So there is a narrowing of possiblities. Second, browsers are built for speed, so high-quality typesetting (e.g., the Knuth&#8211;Plass linebreaking algorithm) is off the table. Third, browsers are  inconsistent in how they render pages. Fourth &#8212; taking off my typography-snob tiara here &#8212; browsers are unstable. What seems well supported today can be broken or removed tomorrow. So browsers can&rsquo;t be a part of a dependable publishing workflow that yields reproducible results.</p><h3>3<tt>&nbsp;</tt><a name="(part._.What_does_.Quad_do_)"></a>What does Quad do?</h3><p>Quad produces finished document layouts using three ingredients:</p><ol><li><p>A <span style="font-weight: bold">markup-based language</span> for embedding high-level typsetting instructions in a text document. (Sort of like XML/HTML.)</p></li><li><p>A <span style="font-weight: bold">typesetting engine</span> that converts these typesetting instructions into an output-independent layout &#8212;&#160;e.g., putting characters into lines, and lines into pages.</p></li><li><p>A <span style="font-weight: bold">rendering engine</span> that takes this layout and prepares it for a particular output format (e.g., PDF, SVG).</p></li></ol><p>While there&rsquo;s no reason Quad couldn&rsquo;t produce an HTML layout, that&rsquo;s an easier problem, because most of the document-layout chores can (and should) be delegated to the web browser. For now, most of Quad&rsquo;s apparatus is devoted to its typesetting engine so it can produce layouts for PDF.</p><h3>4<tt>&nbsp;</tt><a name="(part._.What_doesn_t_.Quad_do_)"></a>What doesn&rsquo;t Quad do?</h3><p><div class="SIntrapara"><ol><li><p>Quad is not a WYSIWYG or interactive previewing tool.</p></li><li><p>Quad does not have user-level representations of formatting, &#224; la Word style sheets.</p></li><li><p>Quad does not handle semantic or configurable markup. Its markup is limited to its specific, layout-based vocabulary.</p></li></ol></div><div class="SIntrapara">Rather, it is designed to cooperate with tools that offer these facilities.</div></p><h3>5<tt>&nbsp;</tt><a name="(part._.Theory_of_operation)"></a>Theory of operation</h3><p>A document processor starts with input that we can think of as one giant line of text. It breaks this into smaller lines, and then distributes these lines across pages. Conceptually, it&rsquo;s a bin-packing problem.</p><ol><li><p>Quad starts with an input file written in the <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> markup language. For the most part, it&rsquo;s text with markup codes (though it may also include things like diagrams and images).</p></li><li><p>Each markup entity is called a <span style="font-style: italic">quad</span>. A quad roughly corresponds to a box. &ldquo;Roughly&rdquo; because quads can have zero or negative dimension. Also, at the input stage, the contents of some quads may end up being spread across multiple non-overlapping boxes (e.g., a quad containing a word might be hyphenated to appear on two lines). The more precise description of a quad is therefore &ldquo;contiguous formatting region.&rdquo; Quads can be recursively nested inside other quads, thus the input file is tree-shaped.</p></li><li><p>This tree-shaped input file is flattened into a list of atomic  quads. &ldquo;Atomic&rdquo; because these are the smallest items the typesetter can manipulate. (For instance, the word <span style="font-style: italic">bar</span> would become three one-character quads. An image or other indivisible box would remain as is.) During the flattening, tags from higher in the tree are propagated downward by copying them into the atomic quads. The result is a &ldquo;stateless&rdquo; representation of the input, in the sense that all the information needed to typeset an atomic quad is contained within the quad itself.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>The input is flattened because typesetting operations are easier to think about as a linear sequence (i.e., an imperative model). To see why, consider how you&rsquo;d handle a page-break instruction within a tree model. No matter how deep you were in your typesetting tree, you&rsquo;d have to jump back to the top level to handle your page break (because it affects the positioning of all subsequent items). Then you&rsquo;d have to jump back to where you were, deep in the tree. That&rsquo;s not a natural way to traverse any tree. This is also why, to my mind, typesetting does not lend itself to a class- or object-based approach, as these create hierarchies that just lead you back to this tree problem.</p></blockquote></blockquote></blockquote></li><li><p>Atomic quads are composed into lines using one of three algorithms. (A line is just a quad of a certain width.) The first-fit algorithm puts as many quads onto a line as it can before moving on to the next. The best-fit algorithm minimizes the total looseness of all the lines in a paragraph (aka the Knuth&#8211;Plass linebreaking algorithm developed for TeX). Because best-fit is more expensive, Quad also has an adaptive-fit algorithm that uses a statistical heuristic to guess whether the paragraph will benefit from best-fit; if not, it uses first-fit.</p></li><li><p>If a typeset paragraph still exceeds certain looseness tolerances, it is hyphenated and the lines recalculated.</p></li><li><p>Once the lines are broken, extra space is distributed within each line according to whether the line should appear centered, left-aligned, justified, etc. The result is a list of quads that fills the full column width.</p></li><li><p>Lines are composed into columns. (A column is just a quad of a certain height.) To support things like footnotes, columns are composed using a backtracking constraint-satisfaction algorithm.</p></li><li><p>Columns are composed into pages.</p></li><li><p>This completes the typesetting phase. Note that at every step in the process, the document is represented in the Quad markup language. There isn&rsquo;t a distinction between the public and private markup interface, or the high- and low-level markup entities. Thus, external tools that generate Quad markup have some latitude.</p></li><li><p>Before the typeset markup is passed to the renderer, it goes through a simplification phase &#8212;&#160;a lot of adjacent quads will have the same formatting characteristics, and these can be consolidated into runs of text.</p></li><li><p>The renderer walks through the markup and draws each quad, using information in the markup attributes to determine position, color, font, size, style, etc.</p></li></ol><h3>6<tt>&nbsp;</tt><a name="(part._.Enough_talk___let_s_rock)"></a>Enough talk &#8212;&#160;let&rsquo;s rock</h3><p>Open DrRacket and start a new document with <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> as the first line:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta">Dale</span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Save the document. Any place, any name is fine.</p><p>Run the document. You&rsquo;ll get output like this:</p><p><span class="RktVal"><span class="RktPn">(</span><span class="RktSym">block</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">measure</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">360.0</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">font</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Times</span><span class="hspace">&nbsp;</span><span class="RktVal">New</span><span class="hspace">&nbsp;</span><span class="RktVal">Roman"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x-align</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">justify</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">leading</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">14.0</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">11.5</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x-align-last-line</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">left</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">column-count</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">column-gutter</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">10.0</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"\n"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Brennan</span><span class="hspace">&nbsp;</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">Dale</span><span class="hspace">&nbsp;</span><span class="RktVal">like</span><span class="hspace">&nbsp;</span><span class="RktVal">fancy</span><span class="hspace">&nbsp;</span><span class="RktVal">sauce.</span><span class="hspace">&nbsp;</span><span class="RktVal">"</span><span class="RktPn">)</span><span class="RktMeta"></span></span></p><p>This is the compiled Quad markup, showing what will get sent to the typesetting engine. This output is itself valid Quad markup (meaning you could put it back in the definitions window and it would compile again).</p><p><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> uses the @-expression reader for ease of use. But these @-expressions become S-expressions in the usual manner. Also as usual, you can prefix any S-expressionized Quad markup with a <span class="RktInBG"><span class="hspace"></span><span class="RktIn">@</span><span class="hspace"></span></span> in the definitions window to turn it back into an @-expression.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><font class="badlink">(part ("(lib scribblings/scribble/scribble.scrbl)" "how-to:reader"))</font> introduces @-expressions.</p></blockquote></blockquote></blockquote><p>Now click the&#160;<span class="ssansserif">Render and Open PDF</span> button. After a moment, this should open your PDF previewing program with the Quad-generated PDF, which will say, unsurprisingly, &ldquo;Brennan and Dale like fancy sauce.&rdquo;</p><p>As you work through the demo, you can alternatively use the <span class="ssansserif">Render PDF</span> button to regenerate the PDF without opening your previewer. (The Preview app on OS X, for instance, will automatically refresh when it detects the PDF has changed, which prevents a welter of windows.)</p><p><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> is a Racket-implemented DSL (= domain-specific language). It&rsquo;s not a language in the sense of Turing-complete. Rather, a <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> &ldquo;program&rdquo; resembles text annotated with high-level layout-description commands (not unlike XML/HTML). <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> programs can be written directly, or generated as the output of other programs.</p><p>Each @-expression in <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> is interpreted as a <span style="font-style: italic">quad</span> (roughly a box; more precisely a contiguous formatting region). A quad has the following syntax:</p><p><span class="RktSym">@quad-name</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">list</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">attr-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">attr-val</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktSym">text-or-more-quads</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">}</span><span class="RktMeta"></span></p><p>The <span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">list</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">attr-name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">attr-val</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktMeta"></span> is an interleaved list of symbols and values, as you might provide to <span class="RktSym"><span class="badlink"><span class="RktValLink">hash</span></span></span>. The attribute list is mandatory. If a quad has no attributes of its own, this can be signaled with either <span class="RktSym">empty</span> or <span class="RktVal">#f</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">@quad-name</span><span class="RktPn">[</span><span class="RktSym">empty</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktSym">text-or-more-quads</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">@quad-name</span><span class="RktPn">[</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktSym">text-or-more-quads</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr></table></blockquote><p>If you thought this resembled an <a href="http://docs.racket-lang.org/pollen/second-tutorial.html#%28part._.X-expressions%29">X-expression</a>, you wouldn&rsquo;t be wrong. Like X-expressions, quads are recursively composable. Also like X-expressions, the attributes in a quad apply to all the text or quads within, unless superseded by another attribute declaration deeper down.</p><p>Let&rsquo;s see how this works. The simplest kind of quad is a <span class="RktSym">block</span><span class="RktMeta"></span>. If we wrap our text in a <span class="RktSym">block</span><span class="RktMeta"></span> without attributes, what happens to the PDF?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta">Dale</span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Right &#8212;&#160;nothing. A block without attributes just evaporates. Move the boundaries of the block:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta">Dale</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Still the same. Let&rsquo;s add some bold formatting with the <span class="RktSym">weight</span><span class="RktMeta"></span> attribute:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">weight</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bold</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta">Dale</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>What an accomplishment. To show you that attributes are additive, we&rsquo;ll put a quad inside our quad:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">weight</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">bold</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">color</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Dale</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>You&rsquo;re getting the idea. In terms of type styling, here are the attributes and values that Quad understands:</p><p><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">weight</span><span class="RktMeta"></span> = <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">normal</span><span class="RktMeta"></span> (default) or <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">bold</span><span class="RktMeta"></span>
<br/><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">style</span><span class="RktMeta"></span> = <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">normal</span><span class="RktMeta"></span> (default) or <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">italic</span><span class="RktMeta"></span>
<br/><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">font</span><span class="RktMeta"></span> = family name as string
<br/><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">size</span><span class="RktMeta"></span> = point size as floating-point number
<br/><span class="RktSym">leading</span><span class="RktMeta"></span> = baseline-to-baseline measure in points
<br/><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">color</span><span class="RktMeta"></span> = color string from <span class="RktSym"><span class="badlink"><span class="RktValLink">color-database&lt;%&gt;</span></span></span></p><p>Feel free to impose these on your demo program.</p><p>Though we&rsquo;re using @-expressions, a <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> source file doesn&rsquo;t imply any formatting characteristics as it would in Scribble or Pollen. For instance, see what happens if you add two line break and some more text:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">color</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Dale</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">&#160;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">Derek</span><span class="hspace">&nbsp;</span><span class="RktMeta">does</span><span class="hspace">&nbsp;</span><span class="RktMeta">not.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>The text &ldquo;Derek does not&rdquo; appears flush against the first sentence. In Scribble those linebreaks would suggest a paragraph break. In HTML they would suggest a word space. In <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> they suggest neither. Why not? Because <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> is strictly a language for describing explicit typesetting. Newlines have no meaning.</p><p>OK, so how do we create a paragraph? Quad supports a special set of quads called <span style="font-style: italic">breaks</span> that move the typesetting position. For instance, <span class="RktSym">@</span><span class="RktPn">(</span><span class="RktSym">block-break</span><span class="RktPn">)</span><span class="RktMeta"></span> will act like a carriage return, moving the next typeset item below the previous item and all the way to the left edge of the column:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">color</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Dale</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktPn">(</span><span class="RktSym">block-break</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">Derek</span><span class="hspace">&nbsp;</span><span class="RktMeta">does</span><span class="hspace">&nbsp;</span><span class="RktMeta">not.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Now &ldquo;Derek does not&rdquo; appears on its own line. What about things like paragraph spacing and first-line indents? Again, because <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> is about explicit typesetting, all these things need to be inserted explicitly in the code. For instance, to make an indent, we add a <span class="RktSym"><span class="badlink"><span class="RktValLink">box</span></span></span><span class="RktMeta"></span> with a <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">width</span><span class="RktMeta"></span> attribute:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">color</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Dale</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktPn">(</span><span class="RktSym">block-break</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym"><span class="badlink"><span class="RktValLink">box</span></span></span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">width</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">15</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">Derek</span><span class="hspace">&nbsp;</span><span class="RktMeta">does</span><span class="hspace">&nbsp;</span><span class="RktMeta">not.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Quad also handles <span class="RktSym">@</span><span class="RktPn">(</span><span class="RktSym">line-break</span><span class="RktPn">)</span><span class="RktMeta"></span>, <span class="RktSym">@</span><span class="RktPn">(</span><span class="RktSym">column-break</span><span class="RktPn">)</span><span class="RktMeta"></span>, and <span class="RktSym">@</span><span class="RktPn">(</span><span class="RktSym">page-break</span><span class="RktPn">)</span><span class="RktMeta"></span>. Try the last one:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">16</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Brennan</span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">color</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"red"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Dale</span><span class="RktPn">}</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">like</span><span class="hspace">&nbsp;</span><span class="RktMeta">fancy</span><span class="hspace">&nbsp;</span><span class="RktMeta">sauce.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktPn">(</span><span class="RktSym">page-break</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym"><span class="badlink"><span class="RktValLink">box</span></span></span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">width</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">15</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">Derek</span><span class="hspace">&nbsp;</span><span class="RktMeta">does</span><span class="hspace">&nbsp;</span><span class="RktMeta">not.</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Next, let&rsquo;s look at Quad&rsquo;s linebreaking mechanism. For the next sample, please paste in a large block of plain text between the curly braces so you&rsquo;ll get some linewrapping:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">A</span><span class="hspace">&nbsp;</span><span class="RktMeta">text</span><span class="hspace">&nbsp;</span><span class="RktMeta">that</span><span class="hspace">&nbsp;</span><span class="RktMeta">goes</span><span class="hspace">&nbsp;</span><span class="RktMeta">on</span><span class="hspace">&nbsp;</span><span class="RktMeta">for</span><span class="hspace">&nbsp;</span><span class="RktMeta">a</span><span class="hspace">&nbsp;</span><span class="RktMeta">while</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr></table></blockquote><p>You will see a block of justified text. The demo is running at maximum quality, so two other things will also be true.</p><p>First, the lines are broken using the Knuth-Plass algorithm developed for TeX. This is a very nice algorithm that looks at all possible ways of breaking the lines in the paragraph and picks the one that leaves the smallest total gap at the right edge. (Quad will also hyphenate if necessary, but only if all the unhyphenated possibilities are bad.)</p><p>Second, notice that punctuation hangs a little outside the text block. This is an optical adjustment that makes for neater-looking blocks. Whether you literally care about this kind of optical adjustment is not the point. The point is that the Quad typesetting engine <span style="font-style: italic">permits</span> it. And that is really what we are going for here: a hackable typesetting engine. When you have fine control over all the page elements, then other things become possible (for instance, mathematical-equation typesetting, which is quite a bit more involved than just hanging punctuation off the edges).</p><p>Justification is the default setting for the demo. To override this setting, use these attributes:</p><p><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">x-align</span><span class="RktMeta"></span> = <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">justify</span><span class="RktMeta"></span> (default), <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">left</span><span class="RktMeta"></span>, <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">center</span><span class="RktMeta"></span>, or <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">right</span><span class="RktMeta"></span>
<span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">x-align-last-line</span><span class="RktMeta"></span> = <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">justify</span><span class="RktMeta"></span> (default), <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">left</span><span class="RktMeta"></span>, <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">center</span><span class="RktMeta"></span>, or <span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktSym">right</span><span class="RktMeta"></span></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">x-align</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">center</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x-align-last-line</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">center</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">A</span><span class="hspace">&nbsp;</span><span class="RktMeta">text</span><span class="hspace">&nbsp;</span><span class="RktMeta">that</span><span class="hspace">&nbsp;</span><span class="RktMeta">goes</span><span class="hspace">&nbsp;</span><span class="RktMeta">on</span><span class="hspace">&nbsp;</span><span class="RktMeta">for</span><span class="hspace">&nbsp;</span><span class="RktMeta">a</span><span class="hspace">&nbsp;</span><span class="RktMeta">while</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Then you can combine blocks with different styles:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">x-align</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">center</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x-align-last-line</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">center</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">24</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">Very</span><span class="hspace">&nbsp;</span><span class="RktMeta">important</span><span class="hspace">&nbsp;</span><span class="RktMeta">headline</span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktPn">(</span><span class="RktSym">block-break</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">style</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">italic</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">A</span><span class="hspace">&nbsp;</span><span class="RktMeta">subhead</span><span class="hspace">&nbsp;</span><span class="RktMeta">that</span><span class="hspace">&nbsp;</span><span class="RktMeta">maybe</span><span class="hspace">&nbsp;</span><span class="RktMeta">lasts</span><span class="hspace">&nbsp;</span><span class="RktMeta">a</span><span class="hspace">&nbsp;</span><span class="RktMeta">few</span><span class="hspace">&nbsp;</span><span class="RktMeta">lines</span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktPn">(</span><span class="RktSym">block-break</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">@</span><span class="RktSym"><span class="badlink"><span class="RktValLink">box</span></span></span><span class="RktPn">[</span><span class="RktSym"><span class="badlink"><span class="RktValLink">'</span></span></span><span class="RktPn">(</span><span class="RktSym">width</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">@</span><span class="RktSym">block</span><span class="RktPn">[</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">{</span><span class="RktMeta">A</span><span class="hspace">&nbsp;</span><span class="RktMeta">text</span><span class="hspace">&nbsp;</span><span class="RktMeta">that</span><span class="hspace">&nbsp;</span><span class="RktMeta">goes</span><span class="hspace">&nbsp;</span><span class="RktMeta">on</span><span class="hspace">&nbsp;</span><span class="RktMeta">for</span><span class="hspace">&nbsp;</span><span class="RktMeta">a</span><span class="hspace">&nbsp;</span><span class="RktMeta">while</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr></table></blockquote><p>In sum, you can build up complex typsetting with a relatively small vocabulary of typsetting commands.</p><p>You are welcome to shovel large quantities of plain text into your <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> window to see it broken into lines and paginated.</p><h3>7<tt>&nbsp;</tt><a name="(part._.Bottlenecks__roadblocks____unanswered_questions)"></a>Bottlenecks, roadblocks, &amp; unanswered questions</h3><p>In no particular order.</p><ol><li><p><span style="font-weight: bold">Flattening is wasteful.</span> Exploding the input into atomic quads and copying the attributes works, but it creates an enormous data structure with a huge amount of repetition. But, how do you create a stateless representation of the input?</p><p><span style="font-style: italic">Possible improvements</span>: Put the attributes into a separate data structure that treats each attribute as having a scope. But this makes editing the input data more difficult &amp; fragile, because you have two parallel structures to keep sychronized. Also, there&rsquo;s probably no reason that the attributes have to allow arbitrary key&#8211;value pairs. If the keys and certain values were reduced to a fixed vocabulary, they could be encoded as (smaller, quicker) integers rather than symbols and strings.</p></li><li><p><span style="font-weight: bold">Allocation is wasteful.</span> Many typesetting operations break bigger quads into smaller ones, or group smaller quads into bigger ones, etc. The result is that there&rsquo;s a lot of allocation &amp; garbage collection relative to the typical Racket program.</p><p><span style="font-style: italic">Possible improvements</span>: Perhaps the input can be fixed some structure and results of each typesetting operation stored as a set of edits (like a diff) rather than copying the whole structure.</p></li><li><p><span style="font-weight: bold">Pango text measuring is slow.</span> The most cumulatively expensive operation is measuring text so linebreaks can be calculated. <font class="badlink"><span class="RktModLink"><span class="RktSym">racket/draw</span></span></font> relies on Pango, which is fine for occasional UI stuff, but not zillions of lookups. (BTW Pango does have higher-level text-layout facilities which are of course faster than measuring characters individually. But the point of Quad is to micromanage the typesetting and thereby make things possible that are not in Pango.)</p><p><span style="font-style: italic">Possible improvements</span>: First, use the FFI to measure text through the underlying FreeType library. This is a lot faster, but costs some functionality. Second, better caching (but see next note).</p></li><li><p><span style="font-weight: bold">Caching is tricky.</span> Caching is an essential ingredient in a text-rendering system because so many measurements are reused. Two hard parts, however. First, simplifying the key logic so you don&rsquo;t end up with immensely huge hashtables with commensurately costly lookups. Second, preserving caches between runs of the program. Sure, save it on disk, but a giant hashtable in a .rktd file is still going to take a moment to be reconstituted into memory.</p><p><span style="font-style: italic">Possible improvements</span>: Rely on disk-based hashtables, i.e., cache files that can be read &amp; updated without having to reconstitute the whole file into a RAM-resident hashtable, and then write it all out again. I&rsquo;m sure someone figured this out in 1972, I just haven&rsquo;t researched it yet.</p></li><li><p><span style="font-weight: bold">Cairo&rsquo;s PDFs are weak.</span> Cairo&rsquo;s PDF generator is missing key features  (e.g., <a href="http://cairographics.org/roadmap/">hyperlinks</a>) and in general makes PDFs that are bigger and less capable than, say, <span class="stt">tex2pdf</span>. Since PDFs are undoubtedly the #1 target format for a document processor, this is a major liability. OTOH, the idea of writing a PostScript/PDF compiler is, for me anyhow, daunting.</p><p><span style="font-style: italic">Possible improvements</span>: Bite the bullet and make a PDF compiler. If one wants to be free of LaTeX, and have better-quality PDFs than Cairo allows, there&rsquo;s not reallyi a second option.</p></li><li><p><span style="font-weight: bold">Overall performance is slow.</span> Outside of text measurement, most of Quad consists of simple mathematical operations. It seems like it should be highly optimizable. (Using Typed Racket, however, wasn&rsquo;t the answer.)</p><p><span style="font-style: italic">Possible improvements</span>: Use more unsafe math operations, gingerly.</p></li><li><p><span style="font-weight: bold">Dependencies are broad.</span> One reason switching to Typed Racket did nothing for Quad is that it touches a lot of other pieces of Racket. In TR&rsquo;s case, creating typed interfaces for untyped libraries consumed all the potential performance gains from static typing. But still, using a small slice of a lot of libraries adds a certain overhead.</p></li><li><p><span style="font-weight: bold">Glyph shaping is nowhere.</span> A proper 21st-century typesetting engine needs OpenType glyph shaping, and the only open-source game in town is <a href="https://www.freedesktop.org/wiki/Software/HarfBuzz/">HarfBuzz</a>. Haven&rsquo;t used it, don&rsquo;t know how to integrate it.</p></li><li><p><span style="font-weight: bold">Parallel processing is difficult.</span> It&rsquo;s unclear to me how to exploit Racket&rsquo;s parallel-processing facilities to speed up typesetting. A typeset document is likely to have a lot of finely interdependent pieces (e.g., table of contents, table of authorities, footnotes, etc.)</p></li><li><p><span style="font-weight: bold">Run-to-run caching is difficult.</span> By this I mean that a common workflow in typesetting is to edit the document, preview the typesetting, make adjustments, preview again, etc. At each step, potentially not that much of the document is changing. But the typesetter needs to run start to finish anyhow.</p><p><span style="font-style: italic">Possible improvements</span>: The most expensive operation is linebreaking. It would be nice to find a way to cache linebreaking between runs &#8212;&#160;e.g., &ldquo;this paragraph hasn&rsquo;t changed, so we can just reuse the linebreaks from last time.&rdquo; But this would require some kind of checksumming of each paragraph and disk caching, which itself would get expensive.</p></li></ol><h3>8<tt>&nbsp;</tt><a name="(part._.Why_is_it_called_.Quad_)"></a>Why is it called Quad?</h3><p>In letterpress printing, a <span style="font-style: italic">quad</span> was a piece of metal used as spacing material within a line.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>